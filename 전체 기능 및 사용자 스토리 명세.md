# 전체 기능 및 사용자 스토리 명세

## 1. 시스템 개요
- 본 시스템은 GYM(헬스장) 회원 관리, 출입 기록, 락커/유니폼 대여, 관리자 인증 및 관리 기능을 제공하는 통합 플랫폼입니다.
- 백엔드는 FastAPI + pymysql 기반, 프론트엔드는 React + Vite + TypeScript 기반으로 구성되어 있습니다.

---

## 2. 주요 도메인 및 데이터 구조

### 2.1 회원(Member)
- 필드: member_id, name, phone_number, gender, membership_type, membership_start_date, membership_end_date, locker_number, locker_type, locker_start_date, locker_end_date, uniform_type, uniform_start_date, uniform_end_date, is_active, created_at 등
- 회원 등급, 락커/유니폼 대여 정보, 출입 기록 등과 연동

### 2.2 관리자(Admin)
- 필드: admin_id, password, created_at, updated_at
- 관리자 인증(JWT), 비밀번호 변경 등 지원

### 2.3 락커/유니폼 대여
- LockerRental: locker_number, rental_type, start_date, end_date, is_active 등
- UniformRental: rental_type, start_date, end_date, is_active 등

### 2.4 출입 기록(Checkin)
- checkin_id, member_id, checkin_time, checkout_time, created_at 등

---

## 3. 백엔드 API/서비스 구조

### 3.1 관리자(Admin) API
- POST   /admin/login                : 관리자 로그인 (비밀번호)
- PUT    /admin/change-password      : 관리자 비밀번호 변경
- GET    /admin/members              : 회원 목록 조회 (검색/필터/페이징)
- POST   /admin/members              : 회원 추가
- GET    /admin/members/{id}         : 회원 상세 조회
- PUT    /admin/members/{id}         : 회원 정보 수정
- DELETE /admin/members/{id}         : 회원 삭제
- GET    /admin/members/{id}/checkins: 회원별 출입 기록 조회
- GET    /admin/today-checkins       : 당일 출입 회원 목록

### 3.2 키오스크/출입 API
- POST   /checkin                    : 키오스크 출입 (휴대폰 뒷자리 4자리)
- GET    /checkin/today              : 당일 출입 기록 목록
- PUT    /checkin/{checkin_id}/checkout: 퇴장 처리
- GET    /checkin/member/{member_id} : 회원별 월별 출입 기록

### 3.3 락커/유니폼 대여 API
- POST   /api/rentals/locker/{id}/extend   : 락커 대여 연장
- POST   /api/rentals/uniform/{id}/extend  : 유니폼 대여 연장
- GET    /api/rentals/lockers/available    : 사용 가능한 락커 목록

---

## 4. 프론트엔드 주요 기능/화면

### 4.1 관리자(Admin) 화면
- 관리자 로그인: 비밀번호 입력, JWT 토큰 발급/저장
- 관리자 대시보드: 회원 목록(검색/필터/페이징), 회원 상세 Drawer(정보/수정/삭제/출입기록), 회원 추가
- 비밀번호 변경, 로그아웃

### 4.2 키오스크(회원 출입) 화면
- 휴대폰 뒷자리 4자리 입력, 키패드 UI
- 동명이인 후보 선택, 출입 처리(입장/퇴장)
- 출입 성공/실패 메시지, 남은 일수 안내
- 안내/공지/유튜브 영상/현재 시간 표시

---

## 5. 교차 검증(백엔드-프론트-DB)

### 5.1 회원 정보 구조 일치
- DB/스키마/프론트 타입 모두 member_id, name, phone_number, gender, membership_type, membership_start_date, membership_end_date, locker_number, locker_type, locker_start_date, locker_end_date, uniform_type, uniform_start_date, uniform_end_date, is_active, created_at 등 일치
- gender: Enum(M/F), 프론트/백엔드 모두 일치
- membership_type, locker_type, uniform_type: '1개월', '3개월', '6개월', '1년' 등 값 일치

### 5.2 API 파라미터/응답 구조 일치
- 관리자/회원/출입/대여 관련 모든 API의 파라미터, 응답 구조가 프론트 서비스/타입과 일치
- 예외/에러 처리(401, 422 등)도 프론트에서 정상 처리

### 5.3 주요 함수/서비스/라우터/스키마 일치
- create/update/delete/get 등 CRUD 함수명, 파라미터, 반환값이 서비스-레포지토리-라우터-프론트까지 일관성 유지
- 출입/대여/로그인/비밀번호 변경 등도 동일

---

## 6. 사용자 스토리(시나리오)

### 6.1 회원 출입(키오스크)
1. 회원이 키오스크에서 휴대폰 뒷자리 4자리를 입력한다.
2. 동명이인 후보가 있으면 선택한다.
3. 출입 성공 시 남은 일수, 이름, 시간 안내 메시지 표시
4. 만료/비활성 회원은 출입 불가 안내

### 6.2 관리자 회원 관리
1. 관리자가 로그인(비밀번호)
2. 회원 목록을 검색/필터/페이징으로 조회
3. 회원 상세 Drawer에서 정보 확인, 수정, 삭제, 출입기록 확인
4. 회원 추가/수정/삭제 시 백엔드와 동기화

### 6.3 락커/유니폼 대여 관리
1. 회원 상세에서 락커/유니폼 대여 정보 확인 및 연장
2. 사용 가능한 락커 목록 조회

### 6.4 관리자 비밀번호 변경
1. 관리자 대시보드에서 비밀번호 변경
2. 기존/신규 비밀번호 입력, 성공 시 안내

---

## 7. 예외/에러 처리
- 인증 만료(401): 프론트에서 자동 로그아웃 및 로그인 페이지 이동
- 입력값 검증(422): 프론트에서 상세 메시지 안내
- 서버 오류(500): 프론트에서 안내 메시지 표시

---

## 8. 확장/유지보수 참고사항
- 모든 API/타입/스키마/DB 구조는 일관성 있게 관리되어야 하며, 변경 시 프론트/백엔드/DB 모두 동기화 필요
- 테스트 데이터/스크립트는 별도 raw SQL 기반으로 작성 필요
- 환경변수(API_BASE_URL 등)는 .env 및 import.meta.env로 관리

---

## 9. 파일/폴더 구조(요약)
- Back/app: main.py, routers/, services/, repositories/, schemas/, utils/
- Front/src: App.tsx, components/, pages/, services/, utils/, constants/, types/, theme/

---

## 10. 기타
- 모든 주요 함수/클래스/컴포넌트/타입/스키마/라우터/서비스는 주석 및 타입 명확화
- 코드/문서/DB 구조가 불일치할 경우 반드시 교차 검증 및 수정 필요

---

*이 문서는 2025-11-24 기준 전체 코드베이스를 자동 분석하여 생성되었습니다.*
